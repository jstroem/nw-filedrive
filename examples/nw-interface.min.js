!function(e,t,r,i,o){var n={directory:"/"},s=null,c=null,a=function(e){return e="/"!=e.substr(-1)?e.substr(0,e.lastIndexOf("/")+1):e.split("/",e.match(/\//g).length-1||0).join("/")+"/",r.normalize(e)},d=function(e,t,r){return{path:t,directory:!1,size:e.size,created_at:e.lastModifiedDate,last_modified:e.lastModifiedDate,uploading:!0,promise:r}},u=function(e){return e.trigger("Filedrive:UpdateDirectory"),""},h=function(e){for(var t=i.readdirSync(e),o=0;o<t.length;o++){var n=r.join(e,t[o]),s=i.statSync(n);"."==n||".."==n||(s.isDirectory()?h(n):i.unlinkSync(n))}i.rmdirSync(e)},l=function(e){for(var t=new Buffer(e.byteLength),r=new Uint8Array(e),i=0;i<t.length;++i)t[i]=r[i];return t},p=function(e){e=this._options=t.extend({},n,e),this.$this=t(this),this.on=t.proxy(this.$this.on,this.$this),this.trigger=t.proxy(this.$this.trigger,this.$this),i.existsSync(e.directory)?s=e.directory:self.trigger("Filedrive:Error","Directory does not exists")},f=function(e){return void 0===e||null===e?e:r.normalize("/"==e.substr(-1)?e:e+"/")};return p.prototype._addRootDirectory=function(e){return r.normalize(f(this._options.directory)+e)},p.prototype._removeRootDirectory=function(e){return 0==e.indexOf(this._options.directory)?e.substr(this._options.directory.length):e},p.prototype._createFileFromPath=function(e,t){var r=this;i.stat(e,function(i,o){i?t(i,null):t(null,{path:r._removeRootDirectory(e),directory:o.isDirectory(),size:o.size,created_at:o.birthtime,last_modified:o.mtime})})},p.prototype._createFiles=function(e,t,r){var i=[],o=function(e,o){"pending"==r.state()&&(e&&r.reject(e),i.push(o),i.length==t.length&&r.resolve(i))};if(0==t.length)r.resolve(i);else for(var n=0;n<t.length;n++)this._createFileFromPath(e+t[n],o)},p.prototype.getFiles=function(e){e=this._addRootDirectory(e);var r=t.Deferred(),o=this;return i.readdir(e,function(t,i){t?r.reject(t):o._createFiles(e,i,r)}),r.promise()},p.prototype.changeDirectory=function(e){if(null!==e&&void 0!==e){e=f(e),s=this._addRootDirectory(e),c&&c.close();var t=this;c=i.watch(s,function(){u(t)}),this.trigger("Filedrive:ChangeDirectory",e)}},p.prototype.openFile=function(e){e.directory?this.changeDirectory(e.path):o.Shell.openItem(this._addRootDirectory(e.path))},p.prototype.deleteFile=function(e){var r=t.Deferred(),o=this,n=function(e){e?r.reject(e):r.resolve(u(o))};return e.directory?(h(this._addRootDirectory(e.path)),n(null)):i.unlink(this._addRootDirectory(e.path),n),r.promise()},p.prototype.rename=function(e,r){var o=t.Deferred(),n=this,s=function(e){e?o.reject(e):o.resolve(u(n))},c=a(e.path)+r;return i.rename(this._addRootDirectory(e.path),this._addRootDirectory(c),s),o.promise()},p.prototype.createFolder=function(e){var r=t.Deferred(),o=this,n=function(e){e?r.reject(e):r.resolve(u(o))},c=s+e;return i.mkdir(c,n),r.promise()},p.prototype.upload=function(e,r){var o=t.Deferred();void 0===r&&(r=e.name);var n=this,c=function(e){e?o.reject(e):o.resolve(u(n))},a=s+r,h=new FileReader;h.onload=function(e){i.writeFile(a,l(e.target.result),c)},h.readAsArrayBuffer(e);var p=o.promise(),f=d(e,this._removeRootDirectory(a),p);return f},p.prototype.exists=function(e){var r=t.Deferred(),o=s+e;return i.exists(o,r.resolve),r.promise()},e.NWInterface=p}(window,jQuery,require("path"),require("fs"),require("nw.gui"));